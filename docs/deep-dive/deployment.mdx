---
title: Deployment Scripts & Automation
sidebarTitle: Deployment
description: Complete deployment automation for enterprise Legal Tech Document Intelligence Platform
---

# Deployment Scripts & Automation

This guide provides comprehensive deployment automation for the Legal Tech Document Intelligence Platform, including one-click deployment, infrastructure-as-code, GitOps, and CI/CD pipelines.

## Quick Start

### One-Click Deployment

Deploy the platform with a single command:

```bash
# Clone the repository
git clone https://github.com/your-org/legal-tech-platform.git
cd legal-tech-platform

# Deploy to development environment
./scripts/deploy.sh dev

# Deploy to staging environment
./scripts/deploy.sh staging

# Deploy to production environment
./scripts/deploy.sh prod
```

<Note>
The deployment script supports `dev`, `staging`, and `prod` environments. Each environment has its own configuration and resource allocation.
</Note>

## Infrastructure as Code

### Terraform Modules

The platform uses Terraform for infrastructure provisioning on AWS.

#### VPC Configuration

```hcl
# modules/vpc/main.tf
module "vpc" {
  source  = "terraform-aws-modules/vpc/aws"
  version = "5.0.0"

  name = "${var.environment}-legal-tech-vpc"
  cidr = var.vpc_cidr

  azs             = var.availability_zones
  private_subnets = var.private_subnet_cidrs
  public_subnets  = var.public_subnet_cidrs

  enable_nat_gateway     = true
  single_nat_gateway     = var.environment == "dev" ? true : false
  enable_vpn_gateway     = false
  enable_dns_hostnames   = true
  enable_dns_support     = true

  # VPC Flow Logs for compliance
  enable_flow_log                      = true
  create_flow_log_cloudwatch_log_group = true
  create_flow_log_iam_role             = true

  tags = {
    Environment = var.environment
    Project     = "legal-tech-platform"
    ManagedBy   = "terraform"
  }
}
```

#### EKS Cluster

```hcl
# modules/eks/main.tf
module "eks" {
  source  = "terraform-aws-modules/eks/aws"
  version = "19.0.0"

  cluster_name    = "${var.environment}-legal-tech-cluster"
  cluster_version = "1.28"

  vpc_id     = var.vpc_id
  subnet_ids = var.private_subnet_ids

  cluster_endpoint_public_access  = var.environment == "dev" ? true : false
  cluster_endpoint_private_access = true

  # Encryption at rest
  cluster_encryption_config = {
    provider_key_arn = var.kms_key_arn
    resources        = ["secrets"]
  }

  # Managed node groups
  eks_managed_node_groups = {
    general = {
      name           = "general-workload"
      instance_types = var.general_instance_types
      min_size       = var.general_min_size
      max_size       = var.general_max_size
      desired_size   = var.general_desired_size

      labels = {
        workload-type = "general"
      }
    }

    ai_processing = {
      name           = "ai-processing"
      instance_types = var.ai_instance_types
      min_size       = var.ai_min_size
      max_size       = var.ai_max_size
      desired_size   = var.ai_desired_size

      labels = {
        workload-type = "ai-processing"
      }

      taints = [{
        key    = "ai-workload"
        value  = "true"
        effect = "NO_SCHEDULE"
      }]
    }
  }

  # Enable IRSA for pod-level AWS permissions
  enable_irsa = true

  tags = {
    Environment = var.environment
    Project     = "legal-tech-platform"
  }
}
```

#### RDS Aurora PostgreSQL

```hcl
# modules/database/main.tf
module "aurora" {
  source  = "terraform-aws-modules/rds-aurora/aws"
  version = "8.0.0"

  name           = "${var.environment}-legal-tech-aurora"
  engine         = "aurora-postgresql"
  engine_version = "15.4"
  instance_class = var.db_instance_class

  instances = {
    writer = {
      instance_class = var.db_instance_class
    }
    reader = {
      instance_class = var.db_reader_instance_class
      promotion_tier = 1
    }
  }

  vpc_id               = var.vpc_id
  db_subnet_group_name = var.db_subnet_group_name
  security_group_rules = {
    eks_ingress = {
      type                     = "ingress"
      from_port                = 5432
      to_port                  = 5432
      source_security_group_id = var.eks_security_group_id
    }
  }

  # Encryption
  storage_encrypted = true
  kms_key_id        = var.kms_key_arn

  # Backup and maintenance
  backup_retention_period = var.environment == "prod" ? 35 : 7
  preferred_backup_window = "02:00-04:00"

  # Performance Insights
  performance_insights_enabled    = true
  performance_insights_kms_key_id = var.kms_key_arn

  tags = {
    Environment = var.environment
    Project     = "legal-tech-platform"
  }
}
```

#### ElastiCache Redis

```hcl
# modules/cache/main.tf
resource "aws_elasticache_replication_group" "redis" {
  replication_group_id = "${var.environment}-legal-tech-redis"
  description          = "Redis cluster for legal tech platform"

  engine               = "redis"
  engine_version       = "7.0"
  node_type            = var.redis_node_type
  num_cache_clusters   = var.environment == "prod" ? 3 : 1
  parameter_group_name = aws_elasticache_parameter_group.redis.name

  port                       = 6379
  subnet_group_name          = aws_elasticache_subnet_group.redis.name
  security_group_ids         = [aws_security_group.redis.id]
  automatic_failover_enabled = var.environment == "prod" ? true : false

  # Encryption
  at_rest_encryption_enabled = true
  transit_encryption_enabled = true
  kms_key_id                 = var.kms_key_arn

  # Maintenance
  maintenance_window       = "sun:05:00-sun:07:00"
  snapshot_retention_limit = var.environment == "prod" ? 7 : 1
  snapshot_window          = "03:00-05:00"

  tags = {
    Environment = var.environment
    Project     = "legal-tech-platform"
  }
}
```

#### OpenSearch

```hcl
# modules/opensearch/main.tf
resource "aws_opensearch_domain" "legal_search" {
  domain_name    = "${var.environment}-legal-tech-search"
  engine_version = "OpenSearch_2.11"

  cluster_config {
    instance_type            = var.opensearch_instance_type
    instance_count           = var.environment == "prod" ? 3 : 1
    zone_awareness_enabled   = var.environment == "prod" ? true : false
    dedicated_master_enabled = var.environment == "prod" ? true : false

    dynamic "zone_awareness_config" {
      for_each = var.environment == "prod" ? [1] : []
      content {
        availability_zone_count = 3
      }
    }
  }

  ebs_options {
    ebs_enabled = true
    volume_size = var.opensearch_volume_size
    volume_type = "gp3"
    throughput  = 250
    iops        = 3000
  }

  encrypt_at_rest {
    enabled    = true
    kms_key_id = var.kms_key_arn
  }

  node_to_node_encryption {
    enabled = true
  }

  domain_endpoint_options {
    enforce_https       = true
    tls_security_policy = "Policy-Min-TLS-1-2-2019-07"
  }

  vpc_options {
    subnet_ids         = var.private_subnet_ids
    security_group_ids = [aws_security_group.opensearch.id]
  }

  tags = {
    Environment = var.environment
    Project     = "legal-tech-platform"
  }
}
```

## GitOps with ArgoCD

### ArgoCD Installation

```yaml
# argocd/install.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://argoproj.github.io/argo-helm
    targetRevision: 5.51.0
    chart: argo-cd
    helm:
      values: |
        server:
          ingress:
            enabled: true
            ingressClassName: nginx
            hosts:
              - argocd.legal-tech.internal
            tls:
              - secretName: argocd-tls
                hosts:
                  - argocd.legal-tech.internal
        dex:
          enabled: true
        redis:
          enabled: true
        controller:
          metrics:
            enabled: true
  destination:
    server: https://kubernetes.default.svc
    namespace: argocd
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
```

### Application Deployment

```yaml
# argocd/apps/legal-tech-platform.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: legal-tech-platform
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: legal-tech
  source:
    repoURL: https://github.com/your-org/legal-tech-platform.git
    targetRevision: HEAD
    path: k8s/overlays/${ENVIRONMENT}
  destination:
    server: https://kubernetes.default.svc
    namespace: legal-tech
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
      allowEmpty: false
    syncOptions:
      - CreateNamespace=true
      - PrunePropagationPolicy=foreground
      - PruneLast=true
    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m
```

### Drift Detection

```yaml
# argocd/apps/drift-detection.yaml
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: drift-detection
  namespace: argocd
spec:
  generators:
    - list:
        elements:
          - name: document-processor
          - name: ai-orchestrator
          - name: compliance-engine
          - name: search-service
  template:
    metadata:
      name: '{{name}}-drift-check'
    spec:
      project: legal-tech
      source:
        repoURL: https://github.com/your-org/legal-tech-platform.git
        targetRevision: HEAD
        path: 'k8s/apps/{{name}}'
      destination:
        server: https://kubernetes.default.svc
        namespace: legal-tech
      syncPolicy:
        syncOptions:
          - Validate=true
          - CreateNamespace=false
```

## CI/CD Pipeline

### GitHub Actions Workflow

```yaml
# .github/workflows/deploy.yaml
name: Deploy Legal Tech Platform

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  AWS_REGION: us-east-1
  ECR_REGISTRY: ${{ secrets.ECR_REGISTRY }}

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'fs'
          security-checks: 'vuln,secret,config'
          severity: 'CRITICAL,HIGH'
          exit-code: '1'

      - name: Run Snyk security scan
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=high

      - name: SAST with CodeQL
        uses: github/codeql-action/analyze@v2
        with:
          languages: javascript, python

  build:
    needs: security-scan
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service:
          - document-processor
          - ai-orchestrator
          - compliance-engine
          - search-service
          - api-gateway
    steps:
      - uses: actions/checkout@v4

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${{ env.AWS_REGION }}

      - name: Login to Amazon ECR
        uses: aws-actions/amazon-ecr-login@v2

      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: ./services/${{ matrix.service }}
          push: true
          tags: |
            ${{ env.ECR_REGISTRY }}/${{ matrix.service }}:${{ github.sha }}
            ${{ env.ECR_REGISTRY }}/${{ matrix.service }}:latest

      - name: Scan image with Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: '${{ env.ECR_REGISTRY }}/${{ matrix.service }}:${{ github.sha }}'
          severity: 'CRITICAL,HIGH'
          exit-code: '1'

  deploy-dev:
    needs: build
    if: github.ref == 'refs/heads/develop'
    runs-on: ubuntu-latest
    environment: development
    steps:
      - uses: actions/checkout@v4

      - name: Deploy to Development
        run: |
          ./scripts/deploy.sh dev ${{ github.sha }}

  deploy-staging:
    needs: build
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - uses: actions/checkout@v4

      - name: Deploy to Staging
        run: |
          ./scripts/deploy.sh staging ${{ github.sha }}

      - name: Run integration tests
        run: |
          ./scripts/integration-tests.sh staging

  deploy-prod:
    needs: deploy-staging
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    environment: production
    steps:
      - uses: actions/checkout@v4

      - name: Request production approval
        uses: trstringer/manual-approval@v1
        with:
          secret: ${{ secrets.GITHUB_TOKEN }}
          approvers: platform-team,security-team
          minimum-approvals: 2

      - name: Deploy to Production
        run: |
          ./scripts/deploy.sh prod ${{ github.sha }}

      - name: Smoke tests
        run: |
          ./scripts/smoke-tests.sh prod

      - name: Notify deployment
        uses: slackapi/slack-github-action@v1
        with:
          payload: |
            {
              "text": "Production deployment completed: ${{ github.sha }}"
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

## Cost Optimization with Spot Instances

### Karpenter Configuration

```yaml
# karpenter/provisioner.yaml
apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
  name: legal-tech-spot
spec:
  requirements:
    - key: karpenter.sh/capacity-type
      operator: In
      values: ["spot", "on-demand"]
    - key: kubernetes.io/arch
      operator: In
      values: ["amd64"]
    - key: node.kubernetes.io/instance-type
      operator: In
      values:
        - m5.large
        - m5.xlarge
        - m5.2xlarge
        - m6i.large
        - m6i.xlarge
        - m6i.2xlarge
        - c5.large
        - c5.xlarge
        - c5.2xlarge

  # Spot instance configuration for 60-90% cost savings
  limits:
    resources:
      cpu: 1000
      memory: 2000Gi

  # Consolidation for cost optimization
  consolidation:
    enabled: true

  # TTL for empty nodes
  ttlSecondsAfterEmpty: 30

  # Provider configuration
  providerRef:
    name: legal-tech-provider

---
apiVersion: karpenter.k8s.aws/v1alpha1
kind: AWSNodeTemplate
metadata:
  name: legal-tech-provider
spec:
  subnetSelector:
    karpenter.sh/discovery: legal-tech-cluster
  securityGroupSelector:
    karpenter.sh/discovery: legal-tech-cluster
  instanceProfile: KarpenterNodeInstanceProfile-legal-tech

  # Spot instance interruption handling
  blockDeviceMappings:
    - deviceName: /dev/xvda
      ebs:
        volumeSize: 100Gi
        volumeType: gp3
        encrypted: true

  tags:
    Environment: production
    ManagedBy: karpenter
```

## Disaster Recovery

### Backup Scripts

```bash
#!/bin/bash
# scripts/backup.sh

set -euo pipefail

ENVIRONMENT=${1:-prod}
BACKUP_BUCKET="legal-tech-backups-${ENVIRONMENT}"
TIMESTAMP=$(date +%Y%m%d-%H%M%S)

echo "Starting backup for ${ENVIRONMENT} environment..."

# Database backup
echo "Backing up Aurora PostgreSQL..."
aws rds create-db-cluster-snapshot \
  --db-cluster-identifier "${ENVIRONMENT}-legal-tech-aurora" \
  --db-cluster-snapshot-identifier "backup-${TIMESTAMP}"

# Redis backup
echo "Backing up ElastiCache Redis..."
aws elasticache create-snapshot \
  --replication-group-id "${ENVIRONMENT}-legal-tech-redis" \
  --snapshot-name "backup-${TIMESTAMP}"

# OpenSearch snapshot
echo "Creating OpenSearch snapshot..."
curl -XPUT "https://${OPENSEARCH_ENDPOINT}/_snapshot/s3-backup/snapshot-${TIMESTAMP}" \
  -H "Content-Type: application/json" \
  -d '{
    "indices": "*",
    "ignore_unavailable": true,
    "include_global_state": true
  }'

# S3 document backup
echo "Syncing S3 documents to backup bucket..."
aws s3 sync "s3://legal-tech-documents-${ENVIRONMENT}" \
  "s3://${BACKUP_BUCKET}/documents/${TIMESTAMP}/" \
  --storage-class GLACIER_IR

# Kubernetes state backup with Velero
echo "Creating Velero backup..."
velero backup create "k8s-backup-${TIMESTAMP}" \
  --include-namespaces legal-tech \
  --storage-location aws-backup \
  --wait

echo "Backup completed successfully!"
```

### Rollback Procedures

```bash
#!/bin/bash
# scripts/rollback.sh

set -euo pipefail

ENVIRONMENT=${1:-prod}
TARGET_VERSION=${2}
ROLLBACK_TYPE=${3:-application}

echo "Starting rollback for ${ENVIRONMENT} to version ${TARGET_VERSION}..."

case $ROLLBACK_TYPE in
  application)
    echo "Rolling back application deployments..."
    
    # Update ArgoCD applications to target version
    argocd app set legal-tech-platform \
      --revision "${TARGET_VERSION}" \
      --sync-policy none
    
    # Sync with rollback
    argocd app sync legal-tech-platform \
      --revision "${TARGET_VERSION}" \
      --force
    
    # Wait for rollout
    kubectl rollout status deployment -n legal-tech -l app.kubernetes.io/part-of=legal-tech-platform
    ;;
    
  database)
    echo "Rolling back database..."
    
    # Restore from snapshot
    aws rds restore-db-cluster-from-snapshot \
      --db-cluster-identifier "${ENVIRONMENT}-legal-tech-aurora-restored" \
      --snapshot-identifier "${TARGET_VERSION}" \
      --engine aurora-postgresql \
      --engine-version 15.4
    
    echo "Database restored. Please update connection strings and verify data."
    ;;
    
  full)
    echo "Performing full environment rollback..."
    
    # Restore Velero backup
    velero restore create --from-backup "k8s-backup-${TARGET_VERSION}" \
      --include-namespaces legal-tech \
      --wait
    
    echo "Full rollback completed."
    ;;
    
  *)
    echo "Unknown rollback type: ${ROLLBACK_TYPE}"
    echo "Usage: ./rollback.sh <environment> <version> [application|database|full]"
    exit 1
    ;;
esac

echo "Rollback completed successfully!"
```

## Environment Configuration

### Development Environment

```yaml
# environments/dev/values.yaml
environment: dev

# Resource allocation
resources:
  requests:
    cpu: "100m"
    memory: "256Mi"
  limits:
    cpu: "500m"
    memory: "512Mi"

# Replicas
replicas:
  documentProcessor: 1
  aiOrchestrator: 1
  complianceEngine: 1
  searchService: 1
  apiGateway: 1

# Database
database:
  instanceClass: db.t3.medium
  storage: 20

# Cache
cache:
  nodeType: cache.t3.micro
  numNodes: 1

# Search
search:
  instanceType: t3.small.search
  instanceCount: 1
  volumeSize: 10
```

### Production Environment

```yaml
# environments/prod/values.yaml
environment: prod

# Resource allocation
resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "2000m"
    memory: "4Gi"

# Replicas with autoscaling
replicas:
  documentProcessor: 3
  aiOrchestrator: 5
  complianceEngine: 2
  searchService: 3
  apiGateway: 3

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 20
  targetCPUUtilization: 70
  targetMemoryUtilization: 80

# Database
database:
  instanceClass: db.r6g.xlarge
  storage: 500
  readReplicas: 2

# Cache
cache:
  nodeType: cache.r6g.large
  numNodes: 3
  multiAZ: true

# Search
search:
  instanceType: r6g.large.search
  instanceCount: 3
  volumeSize: 500
  dedicatedMaster: true
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Cost Estimation" icon="calculator" href="/deep-dive/cost-estimation">
    View detailed cost breakdown and optimization strategies
  </Card>
  <Card title="Security & Compliance" icon="shield" href="/deep-dive/security-compliance">
    Learn about security hardening and compliance procedures
  </Card>
  <Card title="Team Training" icon="graduation-cap" href="/deep-dive/team-training">
    Access comprehensive training materials
  </Card>
  <Card title="System Architecture" icon="sitemap" href="/deep-dive/architecture">
    Deep dive into system architecture and design
  </Card>
</CardGroup>
